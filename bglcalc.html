<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BGL Correction & Meal Calculations + Entry Logger (Serverside) </title>
<script>

function calc(){
var bg=document.getElementById('bg').value;
var carbs=document.getElementById('carbs').value;
var correction=document.getElementById('correction').value;
var target=document.getElementById('target').value;
var carbratio=document.getElementById('carbratio').value;
var mealinfostr=document.getElementById('mealinfo').value;

// the 16 is correction factor and 10 is is BG target this can be changed as needed:
// For adults 5-8 BGL is a good range to have blood sugar levels:
// Change the range (10) and correction factor of (16) as needed
// carbratio can be adjusted to suit needs

var carbcorrect= carbs / carbratio;

// This here is a feature that endo wanted, any BGL below 10 would leave that calculation out
// when adding up the total amount for units. Without this correction would be negative which
// we were told to avoid working with.

var correct=((bg - target) / correction);

if (bg < 10) { 
  var correct=0; 
}
var units= correct + carbcorrect;
		
document.getElementById('result').innerHTML=units;
document.getElementById('result2').innerHTML=correct;
document.getElementById('result3').innerHTML=carbcorrect;
document.getElementById('result4').innerHTML=mealinfostr;
return false
}

function setValue(){
var bg=document.getElementById('bg').value;
var carbs=document.getElementById('carbs').value;
var correction=document.getElementById('correction').value;
var target=document.getElementById('target').value;
var carbratio=document.getElementById('carbratio').value;
var mealinfostr=document.getElementById('mealinfo').value;
var carbcorrect= carbs / carbratio;
var correct=((bg - target) / correction);
  var units= correct + carbcorrect;
  var total = correct + carbcorrect + units;
  var element = document.getElementById("total");
  var theDate = new Date();
  element.value = '<font size="1"><br>Date: <b>' + theDate + '</b> / Carbs Given: <b>' +  carbs + '</b> / BG Correct:<b> ' + correct + '</b> / CarbCorrect:<b> ' + carbcorrect + '</b> / Total Units:<b> ' + units + '</b> / Meal info: <b>' + mealinfostr + '</b><br></font>';
  element.form.submit();
}
</script>

</head>
<body><center><br><br>
Correction Formula: (BGL-10) / 16 = _____<br>
Carb Formula: (Carbs) / 20 = ______<br>
<br><br><br>
<form>
<input type="hidden" name="output" value="">
<p>BGL Correct  <input type="text" id="correction" value="16"></p>
<p>BGL Target <input type="text" id="target" value="10"></p>
<p>Carb Ratio <input type="text" id="carbratio" value="20"></p>
<p>BG Reading <input type="text" id="bg"/></p>
<p>Carb Target <input type="text" id="carbs" /></p>
<p>Meal Info <input type="text" id="mealinfo" value="No Meal Info" maxlength="200" size="40"></p>
</form>

<form action="bglpost.php" method="post">
<input type="hidden" name="total" id="total">
<input type="button" onClick="calc()" value="Calculate" />
<input type="button" onClick="setValue()" value="LogEntry" />
</form>

<br><br>BGL Correction:<b> <div id="result2"></div> </b><br>
<br>Carb Correction:<b> <div id="result3"></div></b><br><br>
<br>Units of insulin:<b> <div id="result"></div> </b>
<br>Meal Info: <b> <div id="result4"></div></b><br>
</center></body>
</html>
